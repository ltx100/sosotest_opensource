<!DOCTYPE html>
<html lang="cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <!-- Title and other stuffs -->
    <title>{{ site_name }}接口测试平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="">

    <link rel="stylesheet" href="/static/style/publicKey.css">

     <!-- Bootstrap -->
    <link href="/static/new_template/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="/static/new_template/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="/static/new_template/vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="/static/new_template/vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- bootstrap-progressbar -->
    <link href="/static/new_template/vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet">
    <!-- JQVMap -->
    <link href="/static/new_template/vendors/jqvmap/dist/jqvmap.min.css" rel="stylesheet"/>
    <!-- bootstrap-daterangepicker -->
    <link href="/static/new_template/vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="/static/new_template/build/css/custom.min.css" rel="stylesheet">
    <link href="/static/new_template/style/commonStyle.css?v={{ static_version }}" rel="stylesheet">
    <link href="/static/style/publicKey.css" rel="stylesheet">

    <!--loading-->
    <link href="/static/style/loading.css" rel="stylesheet">

    <!-- HTML5 Support for IE -->
    <!--[if lt IE 9]>
    <script src="/s/js/html5shim.js"></script>
    <![endif]-->
    <!-- Favicon -->

    <script src="/static/new_template/vendors/jquery/dist/jquery.min.js"></script>
    <script src="/static/js/jquery-cookie/jquery.cookie.js"></script>
    <link rel="stylesheet" href="/static/datetime-picker/bootstrap-datetimepicker.min.css">
    <!--<script type="text/javascript" src="/s/js/bootstrap.js"></script>-->
    <script type="text/javascript" src="/static/datetime-picker/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="/static/datetime-picker/bootstrap-datetimepicker.zh-CN.js"></script>
    <script type="text/javascript" src="/static/datetime-picker/moment-with-local.js"></script>

     <!--这个是jquery发送post的js文件-->
    <script type="text/javascript" src="/static/frame_work/jQueryPOST.js"></script>

    <!-- Bootstrap -->
    <script src="/static/new_template/vendors/bootstrap/dist/js/bootstrap.min.js"></script>

    <link href="/static/new_template/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">

        <!-- 关键字变色使用 -->
    <script src="/static/codeEditor/codemirror.min.js"></script>
    <link rel="stylesheet" href="/static/codeEditor/codemirror.min.css">
    <link href="/static/codeEditor/normalize.min.css" rel="stylesheet">
    <style>
        .CodeMirror {
            height: 200px;
        }
    </style>
</head>
<body class="nav-md">
    <div class="container body">
      <div class="main_container">
<!-- Main content starts -->

<style>
    .CodeMirror {
        height: 300px;
    }
</style>
<div class="content">
    <!-- Sidebar -->
    {% include 'InterfaceTest/HTTPMenu.html' %}
    <!-- Main bar -->
    <div class="right_col" role="main" style="min-height: 1657px;">
         <div class="">
            <div class="page-title">
              <div class="title_left">
                <div class="col-xs-12 form-group pull-right top_search">
                    <h3>{{ text.pageTitle }}</h3>
                  </div>
              </div>
            </div>
            <div class="clearfix"></div>
            <div class="row">
              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>{{ text.subPageTitle }}</h2>
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>

                    </ul>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                    <div  data-parsley-validate class="form-horizontal form-label-left">
                      <div>
                        <h2>基本信息</h2>
                      </div>
                        {% if option != "add" %}
                            {% if option != "copy" %}
                                <div class="form-group" >
                                    <label class="control-label col-md-min-1">接口编号</label>
                                    <div class="col-lg-8">
                                        <input type="text" id="interfaceId" class="form-control col-md-7 col-xs-12" disabled value="">
                                    </div>
                                </div>
                                {% else %}
                            {% endif %}
                        {% endif %}
                      <div class="form-group">
                        <label class="control-label col-md-min-1">接口名称 <span class="required">*</span>
                        </label>
                        <div class="col-lg-8">
                          <input  id="name" placeholder="请输入MOCK的接口名称" type="text"  required="required" class="form-control col-md-7 col-xs-12">
                        </div>
                      </div>
                        <div class="form-group">
                            <label class="control-label col-md-min-1">{{ groupLevel1 }}</label>
                            <div class="col-lg-2" style="width: 13.5%">
                                <select class="form-control" id="businessLine" onchange="switchModule($(this).val())">
                                    {% for business in businessLine %}
                                        <option value="{{ business.id }}">{{ business.bussinessLineName }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <label class="control-label col-md-min-1" style="width:4.3%;">{{ groupLevel2 }}</label>
                            <div class="col-lg-2" style="width: 13.5%">
                                <select class="form-control" id="modules">
{#                                    {% for m in modules %}#}
{#                                        <option value="{{ m.id }}">{{ m.moduleName }}</option>#}
{#                                    {% endfor %}#}
                                </select>
                            </div>
                            <label class="control-label col-md-min-1" style="width:4.3%;">TagKey</label>
                            <div class="col-lg-1" style="padding-right: 0px;padding-left: 0px;width:300px;" >
                                <input type="text" name="tagKey" style="border-radius:0px;height: 34px;resize:none" id="tagKey" class="form-control" placeholder="请输入tag,必须是纯英文或者中划线-" value="common" />
                            </div>
                        </div>

                      <div>
                        <h2>MOCK接口信息</h2>
                      </div>
                         <div class="form-group"  >
                                                <div  class="col-lg-8" style="width:74%;">

                                                    <ul id="interfaceTab" class="nav nav-tabs bar_tabs" style="margin-bottom: 5px">
                                                        <li class="active"><a href="#requestBody"  onclick="$('#btnDiv').css('margin-top','0px')" data-toggle="tab">请求信息</a></li>
                                                    </ul>

                                                    <div id="interfaceTabContent" class="tab-content">
                                                        <div class="tab-pane fade active in" id="requestBody" style="margin-left: 10px;margin-right: 10px">
                                                            <div class="form-group">
                                                                <div class="col-lg-2" style="width:10%;padding-right: 0px">
                                                                    <select class="form-control"  id="methodSelect" onchange="changeBodyTab($(this).val())" style="border-top-right-radius:0em;border-bottom-right-radius:0em;">
                                                                        <option value="GET">GET</option>
                                                                        <option value="POST" selected="">POST</option>
                                                                        <option value="PUT">PUT</option>
                                                                        <option value="PATCH">PATCH</option>
                                                                        <option value="DELETE">DELETE</option>
                                                                        <option value="HEAD">HEAD</option>
                                                                        <option value="OPTIONS">OPTIONS</option>
                                                                    </select>
                                                                </div>
                                                                <div class="col-lg-1" style="width:12%;padding-right: 0px;padding-left: 0px" >
                                                                    <select class="form-control" style="border-radius:0px;" id="URI" >
                                                                        {% for u in uri %}
                                                                        <option value="{{ u.uriKey }}" title="{{ u.uriKey }}：{{ u.uriDesc }}">{{ u.alias }}</option>
                                                                        {% endfor %}
                                                                    </select>
                                                                </div>
                                                                <div class="col-lg-2" style="width:77%;padding-right: 0px;padding-left: 0px" >
                                                                    <input type="text" name="URL" style="border-radius:0px;height: 34px;resize:none" id="URL" class="form-control" placeholder="请输入接口URL，可以用正则" />
                                                                </div>

                                                            </div>
                                                             <div class="form-group">
                                                                    <div class="col-lg-12" >
                                                                        <ul id="myTab2" class="nav nav-tabs bar_tabs"  style="margin-bottom: 0px;margin-top: 15px;">
                                                                            <li><a href="#headerTab" data-toggle="tab">HEADER(0)</a></li>
                                                                            <li><a href="#paramsTab" data-toggle="tab" >PARAMS</a></li>
                                                                            <li  class="active"><a href="#bodyTab" data-toggle="tab">BODY</a></li>
                                                                        </ul>

                                                                        <div id="myTabContent2" class="tab-content">
                                                                            <div class="tab-pane fade" id="headerTab">
                                                                                <div class="form-group">
                                                                                    <div class="col-lg-12">
                                                                                        <table class="table" style="table-layout:fixed;" >
                                                                                            <thead>
                                                                                                <tr style="color: snow" bgcolor="##2A3F54">
                                                                                                    <th style="font-weight: bold;width: 20%" >Key</th>
                                                                                                     <th style="font-weight: bold">Value（可以用正则）</th>
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody id="headerTbody" >
                                                                                                <tr name="headerTr">
                                                                                                    <td style="padding: 0px"><input class="form-control" onclick="addTableTr($(this).parent().parent().parent());$('[href=\'#headerTab\']').text('HEADER('+($('[name=\'headerTr\']').length-1)+')')" name="headerKey" style="background-color: rgb(183, 186, 189);border-radius:0px;"  /></td>
                                                                                                    <td style="padding: 0px"><input class="form-control" onclick="addTableTr($(this).parent().parent().parent());$('[href=\'#headerTab\']').text('HEADER('+($('[name=\'headerTr\']').length-1)+')')" name="headerValue" style="background-color: rgb(183, 186, 189);border-radius:0px;width:95%;" />
                                                                                                    <button class="btn btn-danger" style="float: right; margin-top: -35px; display: none;" onclick="$(this).parent().parent().remove();$('[href=\'#headerTab\']').text('HEADER('+($('[name=\'headerTr\']').length-1)+')')"><i class="fa fa-trash"></i></button></td>
                                                                                                </tr>

                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                            <div class="tab-pane fade" id="paramsTab">
                                                                                <div class="form-group">
                                                                                    <div class="col-lg-12" >
                                                                                        <table class="table" style="table-layout:fixed;">
                                                                                            <thead>
                                                                                                <tr style="color: snow" bgcolor="#2A3F54">
                                                                                                    <th style="font-weight: bold;width: 20%" >Key</th>
                                                                                                     <th style="font-weight: bold">Value  <button class="btn btn-info" onclick="toggleUrlEncode($(this),'params')" style="float: right;margin-top: -8px;margin-bottom: -8px">原始</button></th>
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody id="paramsTbody">
                                                                                                <tr name="paramsTr">
                                                                                                    <td style="padding: 0px">
                                                                                                        <input class="form-control" onclick="addTableTr($(this).parent().parent().parent())" name="paramsKey" style="background-color: rgb(183, 186, 189);border-radius:0px;"  />
                                                                                                    </td>
                                                                                                    <td style="padding: 0px">
                                                                                                        <input class="form-control" onclick="addTableTr($(this).parent().parent().parent())" name="paramsValue" style="background-color: rgb(183, 186, 189);border-radius:0px;width:95%;" />
                                                                                                        <button class="btn btn-danger" style="display:none;float: right;margin-top: -35px;" onclick="$(this).parent().parent().remove()"><i class="fa fa-trash"></i></button>
                                                                                                    </td>
                                                                                                </tr>
                                                                                            </tbody>
                                                                                        </table>
                                                                                        <div class="col-lg-12" style="display:none;">
                                                                                        <button class="btn btn-info" onclick="toggleUrlEncode($(this),'params')" style="float: right;margin-top: 0px;;margin-bottom: 0px">key-value</button>
                                                                                        <textarea type="text" class="form-control Fixed-width" name="parameter" id="parameter" placeholder="请输入测试参数，可以用正则"></textarea>
                                                                                    </div>
                                                                                    </div>


                                                                                </div>
                                                                            </div>
                                                                            <div class="tab-pane fade active in" id="bodyTab" style="margin-left: 20px;margin-right: 20px">
                                                                                <div class="form-group" id="body-raw" style="display:block;">
                                                                                    <div class="col-lg-12" style="padding-left: 0px;padding-right: 0px;">
                                                                                        <textarea type="text"  name="body-raw-input" class="form-control Fixed-width" id="body-raw-input" placeholder="请输入请求体，可以用正则"></textarea>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                      <div>
                        <h2>MOCK响应信息</h2>
                      </div>
                       <div class="form-group"  >


{#                             <div class="form-group">#}
{#                                <label class="control-label col-md-min-1" >优先级</label>#}
{#                                <div class="col-lg-2" style="width: 13.5%">#}
{#                                    <select class="form-control" id="caselevel">#}
{#                                        <option value="0">高</option>#}
{#                                        <option value="5" selected>中</option>#}
{#                                        <option value="9">低</option>#}
{#                                    </select>#}
{#                                </div>#}
{#                             </div>#}

                             <div class="form-group">
                                <div class="col-lg-2">
                                    <input  id="respStatusCode" placeholder="请输入响应状态码" type="text"  required="required" class="form-control col-md-2 col-xs-12" value="200">
                                </div>
                                 <div class="col-lg-2">
                                    <input  id="respStatusReason" placeholder="请输入响应状态描述" type="text"  required="required" class="form-control col-md-2 col-xs-12" value="OK">
                                 </div>
                                 <div class="col-lg-2">
                                    <input  id="respContentType" placeholder="请输入响应体数据类型，默认为空" type="text"  required="required" class="form-control col-md-2 col-xs-12" >
                                </div>
                                 <div class="col-lg-2">
                                    <input  id="respCharset" placeholder="请输入响应体数据编码，默认为空" type="text"  required="required" class="form-control col-md-2 col-xs-12" >
                                </div>
                              </div>

                                <div class="form-group">
                                    <div class="col-lg-8">
                                        <textarea type="text" id="respBody" required="required" class="form-control col-md-7 col-xs-12 Fixed-width"
                                        placeholder="请输入响应体"
                                        ></textarea>
                                    </div>
                                  </div>

                                    <div class="form-group">
                                <div class="col-lg-8">
                                    <table class="table" style="table-layout:fixed;">
                                        <thead>
                                            <tr style="color: snow" bgcolor="##2A3F54">
                                                <th style="font-weight: bold;width: 20%">CookieKey</th>
                                                 <th style="font-weight: bold">CookieValue</th>
                                            </tr>
                                        </thead>
                                        <tbody id="cookieTbody">
                                            <tr name="cookieTr">
                                                <td style="padding: 0px"><input class="form-control" onclick="addTableTr($(this).parent().parent().parent());" name="cookieKey"  style="background-color: rgb(183, 186, 189);border-radius:0px;"></td>
                                                <td style="padding: 0px"><input class="form-control" onclick="addTableTr($(this).parent().parent().parent());" name="cookieValue"  style="background-color: rgb(183, 186, 189);border-radius:0px;width:95%;">
                                                <button class="btn btn-danger" style="float: right; margin-top: -35px; display: none;" onclick="$(this).parent().parent().remove();"><i class="fa fa-trash"></i></button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                    </div>
                                <div class="form-group">
                                <div class="col-lg-8">
                                    <table class="table" style="table-layout:fixed;">
                                        <thead>
                                            <tr style="color: snow" bgcolor="##2A3F54">
                                                <th style="font-weight: bold;width: 20%">RespHeaderKey</th>
                                                 <th style="font-weight: bold">RespHeaderValue</th>
                                            </tr>
                                        </thead>
                                        <tbody id="respHeaderTbody">
                                            <tr name="respHeaderTr">
                                                <td style="padding: 0px"><input class="form-control" onclick="addTableTr($(this).parent().parent().parent());" name="respHeaderKey"  style="background-color: rgb(183, 186, 189);border-radius:0px;"></td>
                                                <td style="padding: 0px"><input class="form-control" onclick="addTableTr($(this).parent().parent().parent());" name="respHeaderValue"  style="background-color: rgb(183, 186, 189);border-radius:0px;width:95%;">
                                                <button class="btn btn-danger" style="float: right; margin-top: -35px; display: none;" onclick="$(this).parent().parent().remove();"><i class="fa fa-trash"></i></button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                    </div>

                         </div>

                        <div  style="display: block;">
                            <input type="checkbox" id="advanceModeCheck" onclick="checkAdvanceDivShow();" />高级模式
                        </div>

                       <div id="advanceDiv" class="form-group"  style="display: none;">
                           <div class="col-lg-8">
                                <textarea type="text" id="advancePythonCodeText" required="required" class="form-control col-md-7 col-xs-12 Fixed-width"
                                placeholder="输入python代码"
                                ></textarea>
                            </div>
                        <div class="col-lg-8">
                                                   <H3>相关变量</H3>
                                    # 传入的变量，大家可以调用，做逻辑判断，返回等使用<br>
                                    "reqMethod":request.method,  # 实际请求的method，GET POST PUT DELTE 等等<br>
                                    "reqUrl":reqUrl, # 事情请求的接口url<br>
                                    "reqParam":reqParam, # 请求行中的参数字符串 k=1&m=2<br>
                                    "reqBody": reqBody,  # 请求体内容<br>
                                    "reqHeader": processedReqHeader,  # 请求header，key都是大写<br>
                        <br>
                                    "GET": request.GET, # GET的参数dict<br>
                                    "POST": request.POST, # POST的参数dict<br>
                        <br>
                                    # 以下为要赋值的字段<br>
                                    # 是否使用代码中的 resp相关的数据，不使用就使用默认的，只有为True的时候，赋值的resp相关的数据才会生效，如果isResp为False，<br>
                                    # 或者为True但是没有对resp*相关的参数进行重新赋值，那么resp*相关的值取MOCK响应信息中的值<br>
                                    "isResp": False,<br>
                                    "respStatusCode":respStatusCode, #返回的状态码，默认 200<br>
                                    "respStatusReason":respStatusReason, #返回的reason，默认 OK<br>
                                    "respContentType":respContentType, #返回的数据类型，默认None<br>
                                    "respCharset":respCharset, #返回的字符集，默认None<br>
                                    "respContent":respContent, #返回的响应体<br>
                                    "respCookie":respCookie, # json string 或者 ""空字符串<br>
                                    "respHeader":respHeader, # json string 或者 ""空字符串

                        </div>
                       </div>

                    </div>
                    <div class="ln_solid" ></div>
                    <div style="width:65%;" class="col-lg-12">
                    {% if option == "add" %}
                        {% if 'HTTP_interface_add' in  permission %}
                        <button style="float: right" type="button" class="btn btn-success btn-lg" onclick="saveOrDebug('save')">&nbsp;&nbsp;&nbsp;&nbsp;保存&nbsp;&nbsp;&nbsp;&nbsp;</button>
                        {% endif %}
                    {% elif option == "select" %}
{#                        {% if "HTTP_interface_edit" in permission %}#}
                            <a href="{% url 'MOCK_HTTP_operationInterface' %}?id={{ id }}&option=edit">
                                <button style="float: right" type="button" class="btn btn-success btn-lg">&nbsp;&nbsp;&nbsp;&nbsp;编辑&nbsp;&nbsp;&nbsp;&nbsp;</button>
                            </a>
{#                        {% endif %}#}
{#                        {% if "HTTP_interface_copy" in permission %}#}
                            <a href="{% url 'MOCK_HTTP_operationInterface' %}?id={{ id }}&option=copy">
                                <button style="float: right" type="button" class="btn btn-success btn-lg">&nbsp;&nbsp;&nbsp;&nbsp;拷贝&nbsp;&nbsp;&nbsp;&nbsp;</button>
                            </a>
{#                        {% endif %}#}
                    {% elif option == "copy" %}
{#                        {% if "HTTP_interface_add" in permission %}#}
                            <a href="javascript:void(0);">
                                <button style="float: right" type="button" class="btn btn-success btn-lg" onclick="saveOrDebug('save')">&nbsp;&nbsp;&nbsp;&nbsp;保存&nbsp;&nbsp;&nbsp;&nbsp;</button>
                            </a>
{#                        {% endif %}#}
                    {% elif option == "edit" %}
{#                            {% if "HTTP_interface_edit" in permission %}#}
                                <button style="float: right" type="button" class="btn btn-success btn-lg" onclick="saveOrDebug('edit')">&nbsp;&nbsp;&nbsp;&nbsp;保存&nbsp;&nbsp;&nbsp;&nbsp;</button>
{#                            {% else %}#}
{#                                    <button style="float: right" type="button" class="btn btn-success btn-lg" onclick="window.close()">&nbsp;&nbsp;&nbsp;&nbsp;关闭&nbsp;&nbsp;&nbsp;&nbsp;</button>#}
{#                            {% endif %}#}
                    {% endif %}
                    </div>
                  </div>
                </div>
              </div>
                <!--调试-->
{#              <div class="x_panel" style="display: none;">#}
{#                  <div class="x_title">#}
{#                    <h2>接口调试</h2>#}
{#                    <ul class="nav navbar-right panel_toolbox">#}
{#                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>#}
{#                      </li>#}
{##}
{#                    </ul>#}
{#                    <div class="clearfix"></div>#}
{#                  </div>#}
{#                  <div class="x_content">#}
{#                    {% include "config/debugBtnPage.html" %}#}
{#                      <div id="debugResult" style="display: none">#}
{#                                                    <table class="table table-striped table-bordered table-hover"#}
{#                                                           style="table-layout:fixed;word-break:break-all;">#}
{#                                                        <thead>#}
{#                                                        <tr style="color: snow" bgcolor="#2A3F54">#}
{#                                                            <th style="width:2%;">编号</th>#}
{#                                                            <th style="width:3%;">测试结果</th>#}
{#                                                            <th style="width:3%;">执行环境</th>#}
{#                                                            <th style="width:8%;">预期结果</th>#}
{#                                                            <th style="width:8%;">实际结果</th>#}
{#                                                            <th style="width:15%;">断言结果</th>#}
{#                                                            <th style="width:3%;">执行前耗时</th>#}
{#                                                            <th style="width:3%;">执行耗时</th>#}
{#                                                            <th style="width:3%;">执行后耗时</th>#}
{#                                                            <th style="width:3%;">总耗时</th>#}
{#                                                            <th style="width:5%;">操作</th>#}
{#                                                        </tr>#}
{#                                                        </thead>#}
{#                                                        <tbody id="debugResultTbody">#}
{##}
{#                                                        </tbody>#}
{#                                                    </table>#}
{#                                                </div>#}
{#                  </div>#}
{#                </div>#}
            </div>

          </div>
    </div>
</div>

<script type="text/javascript">

    var pythonCodeEditor = null;
    function initJudgeVersion() {
     if ("{{ request.session.version }}" !== "CurrentVersion"){
         alert("现在为历史版本页面")
     }
    }
    initJudgeVersion();
    var businessLine_module_relation = $.ajax({
                  url: '{% url 'bmRelation' %}' ,
                  type: 'get',
                  async: false,
             });
    try{
        var bmDict = JSON.parse(businessLine_module_relation.responseText).body;
    }catch (e){
        alert(bmDict);
        alert("获取业务线模块关联失败")
    }
    switchModule($("#businessLine").val());

    function switchModule(blId) {
        $("#modules option").remove();
        var mdSelect = $("#modules");
        for(var index = 0; index < bmDict[blId].length;index ++){
            jQuery("<option></option>").val(bmDict[blId][index]["id"]).text(bmDict[blId][index]["moduleName"]).appendTo(mdSelect);
        }
    }

    var checkResultId = 0;
    var data = {};

    function checkAdvanceDivShow(){
        if($("#advanceModeCheck").prop("checked")){
            $("#advanceDiv").show();
            if(pythonCodeEditor == null){
                pythonCodeEditor = CodeMirror.fromTextArea($("#advancePythonCodeText")[0], {
                    lineNumbers: true,
                    matchBrackets: true,
                    mode: "text/x-python",
                    indentUnit: 4,
                    indentWithTabs: false
                });
            }
        }else{
            $("#advanceDiv").hide();
        }
    }
    function toggleUrlEncode(element,tableName) {
        if(element.text()=="原始"){
            element.parent().parent().parent().parent().css("display","none");
            element.parent().parent().parent().parent().next().css("display","block");
            var tableData = tableDataTourlencode(tableName);
            element.parent().parent().parent().parent().next().children().val(tableData);
        }else {
            element.parent().css("display","none");
            element.parent().prev().attr("style","table-layout: fixed;");
            tableInitList(tableName,urlencodeToList(element.next().val()));
        }
    }

    function formDataTabInit(jsonModel) {
        for(var i = 0 ; i < jsonModel.length ; i++){
            addTableTr($("#body-form-Tbody"));
            var element = $("[name='body-form-Tr']").eq(i);
            var elementKeyTd = element.children().eq(0).children();
            var elementValueTd = element.children().eq(1).children();
            elementKeyTd.eq(0).val(jsonModel[i]["key"]);
            elementKeyTd.eq(1).val(jsonModel[i]["type"]);

            formDataInput_file( element.children().eq(0).children().eq(1));
            if(jsonModel[i]["type"] == "text"){
                elementValueTd.eq(0).val(jsonModel[i]["value"]);
            }else{
                elementValueTd.eq(2).children().eq(1).val(jsonModel[i]["value"]["showPath"]);
                elementValueTd.eq(2).children().eq(2).text(JSON.stringify(jsonModel[i]["value"]));
            }

        }
    }

    function tableInit(elementName,jsonModel) {
        if(JSON.stringify(jsonModel) != "{}") {
            var i = 0;
            for (var key in jsonModel) {
                if (i == ($("[name='" + elementName + "Tr']").length - 1)) {
                    addTableTr($("#" + elementName + "Tbody"));
                }
                var element = $("[name='" + elementName + "Tr']").eq(i).find('td');
                var headerKey = element.eq(0).children();
                var headerValue = element.eq(1).children().eq(0);
                headerKey.val(key);
                headerValue.val(jsonModel[key]);
                if(key != "" || jsonModel[key] != ""){
                     i++;
                }
            }
            var htmlElement = $("[name='" + elementName + "Tr']");
            for(var j=0;j<htmlElement.length;j++){
                if(j > i){
                    htmlElement.eq(j-1).remove();
                }
            }

        }else {
            var htmlElement = $("[name='" + elementName + "Tr']");
            for(var i=0;i<htmlElement.length-1;i++){
                htmlElement.eq(i).remove();
            }
        }
    }


     function tableInitList(elementName,urlencodeList) {
        for(var i=0;i<urlencodeList.length;i++){
             if (i == ($("[name='" + elementName + "Tr']").length - 1)) {
                    addTableTr($("#" + elementName + "Tbody"));
                }
             var element = $("[name='" + elementName + "Tr']").eq(i).find('td');
             var headerKey = element.eq(0).children();
             var headerValue = element.eq(1).children().eq(0);
            headerKey.val(urlencodeList[i][0]);
            headerValue.val(urlencodeList[i][1]);
        }
    }

      function addTableTr(element) {
                var lastElement = element.children().last();
                var lastElementHtml = lastElement.prop("outerHTML");
                lastElement.after(lastElementHtml);
                tableStyle(element)
            }

          function tableStyle(element) {
                var elementList = element.children();
                for(var i=0;i<elementList.length;i++){
                    var elementInput = elementList.eq(i).find("input");
                    if(i != (elementList.length - 1)){
                         elementInput.css("background-color", "");
                         elementInput.attr("onclick", "");
                         elementList.eq(i).find("button").css("display", "block");
                         elementList.eq(i).find("select").attr("disabled", false);
                         elementList.eq(i).find("select").css("background-color", "");
                    }else {
                         elementInput.css("background-color", "rgb(183, 186, 189)");
                         elementList.eq(i).find("button").css("display", "none");
                         elementList.eq(i).find("select").css("background-color", "rgb(183, 186, 189)");
                         elementList.eq(i).find("select").attr("disabled", true);
                    }
                }
            }



    function clickBodyRadio() {
        var checkedRadio =  $("input[name='body']:checked").val();
        if (checkedRadio == "form-data"){
            $("#body-form-data").css("display","block");
            $("#body-x-www-form-urlencoded").css("display","none");
            $("#body-raw-select").css("display","none");
            $("#body-raw").css("display","none");
            $("#body-binary").css("display","none");
        }else if(checkedRadio == "x-www-form-urlencoded"){
            $("#body-x-www-form-urlencoded").css("display","block");
            $("#body-form-data").css("display","none");
            $("#body-raw-select").css("display","none");
            $("#body-raw").css("display","none");
            $("#body-binary").css("display","none");
        }else if(checkedRadio == "raw"){
            $("#body-raw-select").css("display","block");
            $("#body-raw").css("display","block");

            $("#body-x-www-form-urlencoded").css("display","none");
            $("#body-form-data").css("display","none");
            $("#body-binary").css("display","none");
        }else {
            $("#body-raw-select").css("display","none");
            $("#body-raw").css("display","none");

            $("#body-x-www-form-urlencoded").css("display","none");
            $("#body-form-data").css("display","none");
            $("#body-binary").css("display","block");
        }

    }

    function formDataInput_file(element) {
        if(element.val() == "text"){
            element.parent().next().find("input").eq(0).css("display","block");
            element.parent().next().find("div").css("display","none");
            element.parent().next().find("button").css("margin-top","-32.5px")
        }else{
            element.parent().next().find("div").css("display","block");
            element.parent().next().find("input").eq(0).css("display","none");
            element.parent().next().find("button").css("margin-top","2px")
        }
    }


    function tableDataToDict(tabName) {
        var tableTr = $("[name='"+tabName+"Tr']");
        var tableJson = {};
        if(tableTr.length!=0){
            for(var i = 0;i < tableTr.length; i++){
                if(tableTr.eq(i).find("td").eq(0).children().val().trim() == "" && tableTr.eq(i).find("td").eq(1).children().val().trim() == ""){
                    continue;
                }
                tableJson[tableTr.eq(i).find("td").eq(0).children().val().trim()] = tableTr.eq(i).find("td").eq(1).children().val().trim()
            }
        }
        return tableJson;
    }

    function tableDataTourlencode(tabName) {
        var tableTr = $("[name='"+tabName+"Tr']");
        var tableStr = "";
        if(tableTr.length!=0){
            for(var i = 0;i < tableTr.length; i++){
                if(tableTr.eq(i).find("td").eq(0).children().val().trim() == "" && tableTr.eq(i).find("td").eq(1).children().val().trim() == ""){
                    continue;
                }
                tableStr += tableTr.eq(i).find("td").eq(0).children().val().trim()+"="+tableTr.eq(i).find("td").eq(1).children().val().trim();
                if(i != (tableTr.length-2)){
                    tableStr += "&";
                }
            }
        }
        return tableStr;
    }


    function changeHeader(codeType) {
        var headerJson = tableDataToDict("header");
        if(codeType == "" || codeType == "Text"){
            if(headerJson["Content-Type"]){
                delete headerJson["Content-Type"];
            }
        }else{
            headerJson["Content-Type"] = codeType
        }
        tableInit("header",headerJson);
        $("[href='#headerTab']").text("HEADER("+($("[name='headerTr']").length-1)+")")

    }

    function changeBodyTab(method) {
        if(method == "GET" || method == "HEAD"){
             $("[href='#bodyTab']").parent().css("display","none");
             $("[href='#paramsTab']").click();
        }else {
             $("[href='#bodyTab']").parent().css("display","block");
             $("[href='#bodyTab']").click();
        }

    }

    function changeSelectWidth(codeType) {
        switch (codeType.val()) {
            case "Text":
                codeType.css("width","80px");
                break;
            case "text/plain":
                codeType.css("width","150px");
                break;
            case "application/json":
                codeType.css("width","200px");
                break;
            case "application/javascript":
                codeType.css("width","260px");
                break;
            case "application/xml":
                codeType.css("width","200px");
                break;
            case "text/xml":
                codeType.css("width","150px");
                break;
            case "text/html":
                codeType.css("width","150px");
                break;
        }
    }

    function urlencodeToList(str) {
        if(str == ""){
            return []
        }
        var strList = str.split("&");
        var retList = [];
        for (var s in strList){
            var sp = strList[s].split("=");
            if(sp.length == 1){
                retList.push(["",sp[0]])
            }else {
                var strText = "";
                for(var i = 1;i<sp.length;i++){
                    if(i == sp.length -1){
                        strText = strText + sp[i]
                    }else {
                        strText = strText+ sp[i]+"="
                    }
                }
                retList.push([sp[0],strText])
            }
        }
        return retList;
    }

    function urlencodeToDict(str) {
        var strList = str.split("&");
        var strdict = {};
        for (var s in strList){
            var sp = strList[s].split("=");
            strdict[sp[0]] = sp[1]
        }
        return strdict;
    }

    function dataInit() {
        if ("{{ option }}" != "add") {
            if ('{{ option }}' == "select" || '{{ option }}' == "caseCheck") {

                $("[type='text']").attr("disabled", true);
                $("select").attr("disabled", true);
                $("input").attr("onclick", "");
                $("input").attr("disabled", true);
                $("[type='radio']").attr("disabled", true);

            }

            $("#preTab").children().eq(0).attr("class","");
            $("#preTab").children().eq(0).attr("class","active");
            $("#preTabContent").children().eq(0).attr("class","tab-pane fade");
            $("#preTabContent").children().eq(0).attr("class","tab-pane fade active in");

            $("#interfaceTab").children().eq(0).attr("class","");
            $("#interfaceTab").children().eq(0).attr("class","active");
            $("#interfaceTabContent").children().eq(0).attr("class","tab-pane fade");
            $("#interfaceTabContent").children().eq(0).attr("class","tab-pane fade active in");

            $("#afterTab").children().eq(0).attr("class","");
            $("#afterTab").children().eq(0).attr("class","active");
            $("#afterTabContent").children().eq(0).attr("class","tab-pane fade");
            $("#afterTabContent").children().eq(0).attr("class","tab-pane fade active in");

            var ajaxobj = $.ajax({
                url: "{% url 'MOCK_getInterfaceDataForId' %}?id={{ id }}", type: "GET", success: function () {
                    data = JSON.parse(JSON.parse(ajaxobj.responseText).body);
                    $("#interfaceId").val(data["mockId"]);
                    $("#name").val(data["title"]);
                    $("#tagKey").val(data["tagKey"]);
                    $("#businessLine").val(data["businessLineId"]).change();
                    try {
                        $("#modules").val(data["moduleId"]);
                    }catch (e){

                    }
                    var uriflag = 0;
                    $("#URI").children().each(function () {
                        if ($(this).val() == data["uriKey"]) {
                            uriflag++;
                            $(this).attr("selected", true);
                        }
                    });
                    if (uriflag == 0) {
                        $("[value='输入URI']").attr("selected", true);
                        $("#URIInput").val(data["uri"]);
                    }
                    $("#URL").val(data["reqUrl"]);
                    $("#methodSelect").children().each(function () {
                        if ($(this).val() == data["reqMethod"]) {
                            $(this).attr("selected", true);
                        }
                    });
                    console.log(data["reqHeader"])
                    if (data["reqHeader"] !== ""){
                        tableInit("header",JSON.parse(data["reqHeader"]));
                    }
                    if (data["respCookie"] !== ""){
                        tableInit("cookie",JSON.parse(data["respCookie"]));
                    }
                    if (data["respHeader"] !== ""){
                        tableInit("respHeader",JSON.parse(data["respHeader"]));
                    }
                    changeBodyTab(data["reqMethod"]);
                    if (data["mockMode"] == 1){
                        $("#advanceModeCheck").prop("checked",true);
                        checkAdvanceDivShow();
                        pythonCodeEditor.setValue(data["advancedPythonCode"]);
                    }

                    $("[href='#headerTab']").text("HEADER("+($("[name='headerTr']").length-1)+")");
                    var parameter = $("#parameter");
                    var paramsFlag = 0;
                    var paramsList = urlencodeToList(data["reqParam"]);
                    for (var paramsIndex = 0;paramsIndex<paramsList.length;paramsIndex++){
                        if (paramsList[paramsIndex][0] == "" || paramsList[paramsIndex][1] == ""){
                            paramsFlag = 1;
                        }
                    }
                    if (paramsFlag == 0){
                        tableInitList("params",urlencodeToList(data["reqParam"]));
                    }else {
                        parameter.parent().parent().children().eq(0).css("display", "none");
                        parameter.parent().parent().children().eq(1).css("display", "block");
                        parameter.val(data["reqParam"]);
                    }
                    $("#body-raw-input").val(data["reqBody"]);
                    $("#respBody").val(data["respBody"]);
                    $("#respStatusCode").val(data["respStatusCode"]);
                    $("#respStatusReason").val(data["respStatusReason"]);
                    $("#respCharset").val(data["respCharset"]);
                    $("#respContentType").val(data["respContentType"]);
{#                    initAllEditor();#}
                }
            });
        } else{
            initAllEditor();
        }
    }

        //获取url中的参数
        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }


    function result() {
        window.close();
        window.opener.location.href = '/InterfaceTest/HttpInterfaceCheck';
    }

    function moreEnv() {
        if ($('#debugMoreEnv').css("display") == "none") {
            $('#debugMoreEnv').css("display", "block");
        } else {
            $('#debugMoreEnv').css("display", "none");
        }
    }

    function HTMLEncode(html) {
        var temp = document.createElement("div");
        (temp.textContent != null) ? (temp.textContent = html) : (temp.innerText = html);
        var output = temp.innerHTML;
        temp = null;
        return output;
    }

    //查看接口调试详情
    function checkDebugCase(id) {
        $('#resultDetailstr' + id).toggle();
        $('#resultDetails' + id).toggle();
    }
   //跳到事件的地方
    function ShowDiv(element){
        obshowdiv =  element;
        offtop=obshowdiv.offset().top-155;
        offleft=obshowdiv.offset().left;
        obshowdiv.show();
        docheight = $(document).height();
        $('html,body').animate({scrollTop:offtop}, 200);
    }

    function clearResult() {
        $("#debugResultTbody").children().remove();
        checkResultId = 0;
        $("#debugResult").hide();
        $('#clearResult').hide();
    }


    function valLengthVerify(option) {
        if(option !== "debug"){
             if ($("#name").val() == "") {
                alert("接口名称不能为空");
                return false;
            }
        }

        if ($("#URI").val() == "输入URI") {
            if ($("#URIInput").val() == "") {
                alert("URI不能为空");
                return false;
            }
        }

        if ($("#URL").val() == "") {
            alert("接口不能为空");
            return false;
        }else if($("#URL").val().indexOf("?")!=-1){
            alert("url中不能包含问号，参数请填写params，问号自动拼接");
            return false
        }

        var result = true;
        if ($("input[name='body']:checked").val() == "form-data") {
            var fileInput = $("[name='body-form-Tr']");
            fileInput.each(function () {
                var thisElement = $(this).children().eq(0).children();
                if (thisElement.css("background-color") != "rgb(183, 186, 189)") {
                    if (thisElement.val() == "") {
                        alert("form-data的Key值不能为空");
                        result =  false;
                    }
                }
            })
        }
        return result;
    }
    var thisTime = 0;
    var debugFlag = false;
{#    var timeFlag = false;#}
{#    function thisFunction(element) {#}
{#        thisTiem += 1;#}
{#        element.text('获取结果中...'+thisTiem);#}
{#    }#}
{#    function timer(element) {#}
{#        while (timeFlag){#}
{#            alert( element.text());#}
{#            setTimeout(thisFunction(element),1000);#}
{#        }#}
{#    }#}


    function saveOrDebug(option, httpConfKey) {
        if (valLengthVerify(option) == false){
            return;
        }

        var formData = new FormData();

        var interfaceId = '';
        if ("{{ option }}" != "add") {
            interfaceId = $("#interfaceId").val();
        }

        var title = $("#name").val();
        var tagKey = $("#tagKey").val();

        var businessLineId = $("#businessLine option:selected").val();

        var moduleId = $("#modules option:selected").val();
        if (!moduleId){
            alert("请选择模块");
            return
        }
        var uri = $("#URI").val();
        var method = $("#methodSelect").val();
        var header = JSON.stringify(tableDataToDict("header"));
        var url = $("#URL").val();
        var paramsElement = $("#parameter");
        if (paramsElement.parent().css("display") == "none") {
            var params = tableDataTourlencode("params");
        } else {
            var params = paramsElement.val();
        }
        var bodyContent = '';
        if (method != "GET" && method !="HEAD") {
            bodyContent = $("#body-raw-input").val();
        }

        var respCookie = JSON.stringify(tableDataToDict("cookie"));
        var respHeader = JSON.stringify(tableDataToDict("respHeader"));
        var respStatusCode = $("#respStatusCode").val();
        var respStatusReason = $("#respStatusReason").val();
        var respContentType = $("#respContentType").val();
        var respCharset = $("#respCharset").val();
        var respBody = $("#respBody").val();
        var isAdvanceChecked = $("#advanceModeCheck").prop("checked");
        var mockMode = 0;
        var advancedPythonCode  = "";
        if(isAdvanceChecked){
            mockMode = 1;
            advancedPythonCode = pythonCodeEditor.getValue();
            if (advancedPythonCode.indexOf("import ") != -1){
                alert("不能执行import，如果有import需求，请联系管理员！");
                return;
            }

        }

        var interfaceData = {
            mockId: interfaceId,
            title: title,
            tagKey: tagKey,
            businessLineId: businessLineId,
            moduleId: moduleId,

            uriKey: uri,
            reqMethod: method,
            reqHeader: header,
            reqUrl: url,
            reqParam: params,
            reqBody:bodyContent,

            respCookie:respCookie,
            respHeader:respHeader,
            respStatusCode:respStatusCode,
            respStatusReason:respStatusReason,
            respContentType:respContentType,
            respCharset:respCharset,
            respBody:respBody,
            mockMode:mockMode,
            advancedPythonCode:advancedPythonCode
        };

        if (option == "save") {
            formData.append("interfaceData",JSON.stringify(interfaceData));
             var interfaceAdd = $.ajax({
                  url: '{% url 'MOCK_HTTP_InterfaceAdd' %}' ,
                  type: 'POST',
                  data: formData,
                  async: false,
                  cache: false,
                  contentType: false,
                  processData: false
             });

{#            var interfaceAdd = $.ajax({#}
{#                url: "{% url 'HTTP_InterfaceAdd' %}",#}
{#                async: false,#}
{#                data: interfaceData,#}
{#                type: "POST"#}
{#            });#}

            var interfaceAddJson = JSON.parse(interfaceAdd.responseText);
            if (interfaceAddJson["code"] == "10000") {
                if ("{{ option }}" == 'copy') {
                    window.close();
                    window.opener.location.reload();
                } else {
                    location.href = '{% url 'MOCK_HTTP_InterfaceCheck' %}';
                }
            } else {
                alert(interfaceAdd.responseText);
            }
        } else if (option == "debug") {
            thisTime = 0;
            debugFlag = true;
            checkResultId++;
            interfaceData.httpConfKey_id = httpConfKey;
            $("[name='debug']").attr("disabled", true);
            formData.append("interfaceData",JSON.stringify(interfaceData));
            var interfaceDebugAdd = $.ajax({
                 url: '{% url 'HTTP_InterfaceDebugAdd' %}' ,
                  type: 'POST',
                  data: formData,
                  async: false,
                  cache: false,
                  contentType: false,
                  processData: false
{#                url: "{% url 'HTTP_InterfaceDebugAdd' %}",#}
{#                async: false,#}
{#                data: interfaceData,#}
{#                type: "POST"#}
            });

            var debugAddJson = JSON.parse(interfaceDebugAdd.responseText);
            var runing = ' <tr><td  colspan="11" align="center" style="font-size: 30px" >获取结果中...</td></tr>';
            $("#debugResultTbody").html(runing +  $("#debugResultTbody").html());

            $("#debugResult").show();
            $("#clearResult").show();
            if (debugAddJson["code"] == "10000") {
                $.ajax({
                    url: "{% url 'HTTP_InterfaceDebug' %}",
                    async: true,
                    data: debugAddJson,
                    type: "POST",
                    success: function () {
                        function debugResult() {
                            var url = "{% url 'HTTP_InterfaceDebugGetResult' %}";
                            console.log(debugAddJson)
                            var getDebugResult = $.ajax({
                                url: url, async: true,
                                type:"POST",
                                data: debugAddJson,
                                success: function () {
                                    var msg = 0;
                                    var jsonValue = getDebugResult.responseText;
                                    try{
                                         var returnMsg = JSON.parse(jsonValue);
                                    }catch (err) {
                                        msg = 10000
                                    }
                                    if (msg ==10000) {

                                        if (jsonValue.url == "/UserLogin") {
                                            location.href = jsonValue.url;
                                            result();
                                        }

                                        try {
                                            $("#debugResultTbody").children().first().remove();
                                            $("#debugResultTbody").html(jsonValue + $("#debugResultTbody").html());
                                            var debugId = $("[name='debugId']");
                                            var debugBtnCheckDetails = $("[name='debugBtnCheckDetails']");
                                            var resultDetails = $("[name='resultDetails']");
                                            for (var i = 0; i< debugId.length;i++){
                                                debugBtnCheckDetails.eq(i).attr("onclick","checkDebugCase('"+(i+1)+"');ShowDiv($(this))");
                                                resultDetails.eq(i).attr("id","resultDetailstr"+(i+1));
                                            }
    {#                                        for(var i=debugId.length;i>=0;i--){#}
    {#                                            debugId.eq(i).text(debugId.length-i);#}
    {#                                        }#}
                                            debugId.first().text(debugId.length);
                                            var HTTPRequestSpan = JSON.parse($("[name='HTTPRequestSpan']").first().text());
                                            var HTTPRequestText = "";

                                            var HTTPBodyContent = $("[name='HTTPBodyContent']").first().text();
                                            var HTTPURL = $("[name='HTTPURL']").first().text();
                                            var HTTPParams = $("[name='HTTPParams']").first().text();
                                            var HTTPMethod = $("[name='HTTPMethod']").first().text();
                                            if(HTTPParams == "未设置参数"){
                                                HTTPRequestText = HTTPMethod+ " " + HTTPURL+" HTTP/1.1";
                                            }else{
                                                HTTPRequestText = HTTPMethod + " " + HTTPURL+"?"+HTTPParams+" HTTP/1.1";
                                            }



                                            for(var HTTPRequestKey in HTTPRequestSpan){
                                                HTTPRequestText = HTTPRequestText +"\n"+HTTPRequestKey+":"+HTTPRequestSpan[HTTPRequestKey];
                                            }
                                            if(HTTPBodyContent != ""){
                                                HTTPRequestText = HTTPRequestText + "\n\n"+HTTPBodyContent;
                                            }

                                             $("[name='HTTPRequestText']").first().text(HTTPRequestText);


                                            var HTTPResultSpan = JSON.parse($("[name='HTTPResultSpan']").first().text());
                                            var HTTPResultText = '';
                                            var HTTPActualText = "";
{#                                            switch (HTTPResultSpan["status_code"]) {#}
{#                                                case 200:#}
{#                                                    HTTPResultText = "HTTP/1.1 200 OK";#}
{#                                                    break;#}
{#                                                case 404:#}
{#                                                    HTTPResultText = "HTTP/1.1 404 NOT FOUND";#}
{#                                                    break;#}
{#                                                default:#}
{#                                                    HTTPResultText = "HTTP/1.1 " + HTTPResultSpan["status_code"] + " 不识别的状态码";#}
{#                                            }#}
                                            HTTPResultText = "HTTP/1.1 " + HTTPResultSpan["reason"];


                                            for (var HTTPResultKey in HTTPResultSpan["headers"]) {
                                                HTTPResultText = HTTPResultText + "\n" + HTTPResultKey + ":" + HTTPResultSpan["headers"][HTTPResultKey];
                                            }
                                            if (HTTPResultSpan["content"] != "") {
                                                HTTPResultText = HTTPResultText + "\n\n" + HTTPResultSpan["content"];
                                                HTTPActualText = HTTPResultSpan["content"];
                                            }
                                            $("[name='HTTPActualText']").first().text(HTTPActualText);
                                            $("[name='HTTPResultText']").first().text(HTTPResultText);

                                        } catch (err) {
                                            $("[name='HTTPActualText']").first().text($("[name='HTTPResultSpan']").first().text());
                                            $("[name='HTTPResultText']").first().text($("[name='HTTPResultSpan']").first().text());
                                        }

                                        $("[name='debug']").attr("disabled", false);
                                    } else if (returnMsg["code"] == 16002) {
                                        thisTime += 1;
                                        $("#debugResultTbody").children().first().children().first().html("获取结果中...已执行"+thisTime+
                                            "秒&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;点击<button class=\"btn btn-danger\" onclick=\"cancelDebug()\">取消</button>调试"
                                        );
                                        if(debugFlag){
                                            debugResult();
                                        }else {
                                             $("#debugResultTbody").children().first().remove();
                                             $("#debugResultTbody").html( '<tr><td name=\'debugId\'>' + checkResultId + '</td><td colspan="10" align="center"  style="font-size: 30px" >调试已取消</td></tr>' + $("#debugResultTbody").html());
                                        }
                                    } else {
                                         $("#debugResultTbody").children().first().remove();
                                        $("#debugResultTbody").html('<tr><td name=\'debugId\'>' + checkResultId + '</td><td colspan="10" align="center"  style="font-size: 30px" >结果获取失败，请联系管理员&nbsp;&nbsp;errorCode：' + returnMsg["code"] + '</td></tr>' + $("#debugResultTbody").html());
                                        $("[name='debug']").attr("disabled", false);
                                    }

                                },
                                error: function () {
                                    thisTime = 0;
                                    debugFlag = false;
                                    $("#debugResultTbody").children().first().remove();
                                    $("#debugResultTbody").html('<tr><td name=\'debugId\' >' + checkResultId + '</td>' + checkResultId + '<td colspan="10" align="center"  style="font-size: 30px" >结果获取失败，服务器异常。'+jsonValue+'</td></tr>' +  $("#debugResultTbody").html());
                                    $("[name='debug']").attr("disabled", false);
                                }
                            });

                        }

                        debugResult();
                    },
                    error:function () {
                         $("#debugResultTbody").children().first().remove();
                                    $("#debugResultTbody").html('<tr><td> name=\'debugId\'' + checkResultId + '</td>' + checkResultId + '<td colspan="10" align="center"  style="font-size: 30px" >结果获取失败，服务器异常。'+jsonValue+'</td></tr>' +  $("#debugResultTbody").html());
                                    $("[name='debug']").attr("disabled", false);
                    }

                });
            } else {
                 $("#debugResultTbody").children().first().remove();
                $("#debugResultTbody").html( '<tr><td name=\'debugId\'>' + checkResultId + '</td><td colspan="10" align="center"  style="font-size: 30px" >' + interfaceDebugAdd.responseText + '</td></tr>' + $("#debugResultTbody").html());
                $("[name='debug']").attr("disabled", false);
            }

            return;
        } else if (option == "edit") {
                interfaceData.id = data["id"];
                interfaceData.addBy = data["addBy"];
                formData.append("interfaceData",JSON.stringify(interfaceData));
                 var saveEditAjax = $.ajax({
                      url: '{% url 'MOCK_HTTP_InterfaceSaveEdit' %}' ,
                      type: 'POST',
                      data: formData,
                      async: false,
                      cache: false,
                      contentType: false,
                      processData: false
                 });

    {#            var saveEditAjax = $.ajax({#}
    {#                url: "{% url 'HTTP_InterfaceSaveEdit' %}",#}
    {#                async: false,#}
    {#                data: JSON.stringify(interfaceData),#}
    {#                type: "POST"#}
    {#            });#}
                if (JSON.parse(saveEditAjax.responseText)["code"] == 10000) {
                    window.close();
                    window.opener.location.reload();
                } else {
                    alert(JSON.parse(saveEditAjax.responseText)["message"])
                }
            }



    }
   function cancelDebug() {
        thisTime = 0;
        debugFlag = false;
        $("[name='debug']").attr("disabled", false);
    }
    function pageInit() {
        dataInit();
    }

    pageInit();
    window.onload = function () {
        $("#surprise").click();
        $("#surprise2").click();
    };


</script>

<!-- Content ends -->
{% include 'InterfaceTest/foot.html' %}